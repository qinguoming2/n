<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta name="generator" content="Quarkdown">
    <meta charset="UTF-8">
    <meta name="description" content="a blog demo">
    <meta name="author" content="qinguoming">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="quarkdown:root-path" content="..">
    <title>blog</title>
    <script src="../script/quarkdown.js"></script>
    <script>const capabilities = window.quarkdownCapabilities</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="../theme/theme.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <link href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" rel="stylesheet">
    <script>capabilities.code = true;</script>
    <style>@font-face { font-family: '-503305824'; src: local('Consolas'); }

body {
    --qd-code-custom-font: '-503305824';
    --qd-main-font-size: 12.0pt;}

body.quarkdown-plain.quarkdown-plain,
body.quarkdown-docs.quarkdown-docs {
}

body.quarkdown-slides.quarkdown-slides .reveal {
}

@page {
    size: auto auto;
    margin: 0;}

p {
}</style>
    <script>prepare(new PlainDocument());</script>
<template id="sidebar-template"><nav class="sidebar" role="doc-toc"><ol><li data-target-id="eigen稀疏矩阵格式及使用方法" data-depth="1"><a href="#eigen稀疏矩阵格式及使用方法">Eigen稀疏矩阵格式及使用方法</a><ol><li data-target-id="稀疏矩阵格式" data-depth="2"><a href="#稀疏矩阵格式">稀疏矩阵格式</a><ol><li data-target-id="压缩存储只存储非零值" data-depth="3"><a href="#压缩存储只存储非零值">压缩存储：只存储非零值</a></li></ol></li><li data-target-id="一eigen中的稀疏矩阵格式" data-depth="2"><a href="#一eigen中的稀疏矩阵格式">一、Eigen中的稀疏矩阵格式</a></li><li data-target-id="二稀疏矩阵的定义方法" data-depth="2"><a href="#二稀疏矩阵的定义方法">二、稀疏矩阵的定义方法</a><ol><li data-target-id="_1-直接定义稀疏矩阵" data-depth="3"><a href="#_1-直接定义稀疏矩阵">1. 直接定义稀疏矩阵</a></li><li data-target-id="_2-使用triplet列表构建稀疏矩阵" data-depth="3"><a href="#_2-使用triplet列表构建稀疏矩阵">2. 使用Triplet列表构建稀疏矩阵</a></li><li data-target-id="_3-从密集矩阵转换" data-depth="3"><a href="#_3-从密集矩阵转换">3. 从密集矩阵转换</a></li></ol></li><li data-target-id="三稀疏矩阵的索引方法" data-depth="2"><a href="#三稀疏矩阵的索引方法">三、稀疏矩阵的索引方法</a><ol><li data-target-id="_1-使用coeffref访问元素" data-depth="3"><a href="#_1-使用coeffref访问元素">1. 使用coeffRef()访问元素</a></li><li data-target-id="_2-使用insert和prune方法" data-depth="3"><a href="#_2-使用insert和prune方法">2. 使用insert()和prune()方法</a></li><li data-target-id="_3-迭代非零元素" data-depth="3"><a href="#_3-迭代非零元素">3. 迭代非零元素</a></li><li data-target-id="_4-块操作" data-depth="3"><a href="#_4-块操作">4. 块操作</a></li></ol></li><li data-target-id="四稀疏矩阵的特殊操作" data-depth="2"><a href="#四稀疏矩阵的特殊操作">四、稀疏矩阵的特殊操作</a><ol><li data-target-id="_2-获取稀疏矩阵信息" data-depth="3"><a href="#_2-获取稀疏矩阵信息">2. 获取稀疏矩阵信息</a></li><li data-target-id="_3-稀疏矩阵运算" data-depth="3"><a href="#_3-稀疏矩阵运算">3. 稀疏矩阵运算</a></li></ol></li><li data-target-id="五性能考虑" data-depth="2"><a href="#五性能考虑">五、性能考虑</a></li></ol></li></ol></nav>
</template>  </head>
  <body class="quarkdown quarkdown-plain">
    <aside class="margin-area" id="margin-area-left"></aside>
    <main><div class="container fullwidth" style="justify-items: end; text-align: end;"><p><a href="https://blog.qgm1702.top/">返回 主页</a></p></div><div class="page-break" data-hidden=""></div><h1 id="eigen稀疏矩阵格式及使用方法">Eigen稀疏矩阵格式及使用方法</h1><p>参考链接：</p><ul><li><p><a href="https://zhuanlan.zhihu.com/p/188700729">https://zhuanlan.zhihu.com/p/188700729</a></p></li><li><p><a href="https://eigen.tuxfamily.org/dox/group__SparseQuickRefPage.html">https://eigen.tuxfamily.org/dox/group__SparseQuickRefPage.html</a></p></li><li><p><a href="https://eigen.tuxfamily.org/dox/group__TutorialSparse.html">https://eigen.tuxfamily.org/dox/group__TutorialSparse.html</a></p></li></ul><p>详细介绍Eigen中的稀疏矩阵格式、定义方法以及索引方法。</p><h2 id="稀疏矩阵格式">稀疏矩阵格式</h2><h3 id="压缩存储只存储非零值">压缩存储：只存储非零值</h3><p>存储矩阵的一般方法是采用二维数组，其优点是可以随机地访问每一个元素，因而能够容易实现矩阵的各种运算。</p><p>对于稀疏矩阵，它通常具有很大的维度，有时甚大到整个矩阵（零元素）占用了绝大部分内存</p><p>采用二维数组的存储方法既浪费大量的存储单元来存放零元素，又要在运算中浪费大量的时间来进行零元素的无效运算。因此必须考虑==对稀疏矩阵进行压缩存储（只存储非零元素）==</p><h2 id="一eigen中的稀疏矩阵格式">一、Eigen中的稀疏矩阵格式</h2><p>Eigen主要支持以下几种稀疏矩阵存储格式：</p><ol><li><p><strong>Compressed Sparse Column (CSC)</strong> - 压缩稀疏列格式</p><ul><li>默认格式，也是最高效的格式</li><li>适合列优先操作</li></ul></li><li><p><strong>Compressed Sparse Row (CSR)</strong> - 压缩稀疏行格式</p><ul><li>适合行优先操作</li><li>按行对矩阵进行压缩的</li><li>需要通过<span class="codespan-content"><code>SparseMatrix&lt;double, RowMajor&gt;</code></span>指定</li><li>适用：==常用于读入数据后进行稀疏矩阵计算，运算高效==</li><li>优点：<ul><li>高效的稀疏矩阵算术运算</li><li>高效的行切片</li><li>快速地矩阵矢量积运算</li></ul></li></ul></li><li><p><strong>Triplet格式 (COO)</strong> - 坐标列表格式</p><ul><li>用于构建稀疏矩阵的中间格式</li><li>每个非0值用(row, column, value)三元组列表表示</li><li>应用场景：<ul><li>主要用来创建矩阵，因为coo_matrix无法对矩阵的元素进行增删改等操作</li><li>一旦创建之后，除了将之转换成其它格式的矩阵，几乎无法对其做任何操作和矩阵运算</li></ul></li><li>优点：<ul><li>转换成其它存储格式很快捷简便，能与CSR / CSC格式的快速转换</li><li>允许重复的索引（例如在1行1列处存了值2.0，又在1行1列处存了值3.0，则转换成其它矩阵时就是2.0+3.0=5.0）</li></ul></li><li>缺点：<ul><li>不支持切片和算术运算操作；</li></ul></li></ul></li></ol><blockquote><p>稀疏矩阵的顺序：COO用于读取和构造稀疏矩阵变量&rarr;Coo转换为csr/csc进行矩阵操作和运算；</p></blockquote><h2 id="二稀疏矩阵的定义方法">二、稀疏矩阵的定义方法</h2><h3 id="_1-直接定义稀疏矩阵">1. 直接定义稀疏矩阵</h3><pre><code class="language-cpp">#include &lt;Eigen/Sparse&gt;

// 定义一个10x10的双精度稀疏矩阵(默认CSC格式)
Eigen::SparseMatrix&lt;double&gt; mat(10, 10);

// 定义一个行优先的稀疏矩阵
Eigen::SparseMatrix&lt;double, Eigen::RowMajor&gt; row_major_mat(10, 10);</code></pre><h3 id="_2-使用triplet列表构建稀疏矩阵">2. 使用Triplet列表构建稀疏矩阵</h3><pre><code class="language-cpp">#include &lt;Eigen/Sparse&gt;

// 定义Triplet列表
std::vector&lt;Eigen::Triplet&lt;double&gt;&gt; triplets;

// 添加非零元素 (行索引, 列索引, 值),索引是0-based
triplets.push_back(Eigen::Triplet&lt;double&gt;(0, 0, 1.0));
triplets.push_back(Eigen::Triplet&lt;double&gt;(1, 1, 2.0));
triplets.push_back(Eigen::Triplet&lt;double&gt;(2, 2, 3.0));

// 创建稀疏矩阵并填充
Eigen::SparseMatrix&lt;double&gt; mat(3, 3);
mat.setFromTriplets(triplets.begin(), triplets.end());</code></pre><h3 id="_3-从密集矩阵转换">3. 从密集矩阵转换</h3><pre><code class="language-cpp">Eigen::MatrixXd dense_mat = Eigen::MatrixXd::Random(5, 5);
Eigen::SparseMatrix&lt;double&gt; sparse_mat = dense_mat.sparseView();</code></pre><h2 id="三稀疏矩阵的索引方法">三、稀疏矩阵的索引方法</h2><h3 id="_1-使用coeffref访问元素">1. 使用coeffRef()访问元素</h3><pre><code class="language-cpp">Eigen::SparseMatrix&lt;double&gt; mat(3, 3);
mat.coeffRef(0, 0) = 1.0;  // 设置(0,0)元素
double val = mat.coeff(1, 1);  // 获取(1,1)元素</code></pre><p>注意：<span class="codespan-content"><code>coeffRef()</code></span>会自动插入不存在的元素，而<span class="codespan-content"><code>coeff()</code></span>只是读取。</p><h3 id="_2-使用insert和prune方法">2. 使用insert()和prune()方法</h3><pre><code class="language-cpp">mat.insert(0, 0) = 1.0;  // 高效插入新元素
mat.insert(1, 1) = 2.0;
mat.prune(0.0);  // 移除所有数值为0的元素</code></pre><h3 id="_3-迭代非零元素">3. 迭代非零元素</h3><pre><code class="language-cpp">// 外部迭代器
for (int k = 0; k &lt; mat.outerSize(); ++k) {
    for (Eigen::SparseMatrix&lt;double&gt;::InnerIterator it(mat, k); it; ++it) {
        std::cout &lt;&lt; &quot;(&quot; &lt;&lt; it.row() &lt;&lt; &quot;,&quot; &lt;&lt; it.col() &lt;&lt; &quot;) = &quot; 
                  &lt;&lt; it.value() &lt;&lt; std::endl;
    }
}</code></pre><h3 id="_4-块操作">4. 块操作</h3><pre><code class="language-cpp">// 获取左上角2x2的子矩阵
Eigen::SparseMatrix&lt;double&gt; block = mat.block(0, 0, 2, 2);</code></pre><h2 id="四稀疏矩阵的特殊操作">四、稀疏矩阵的特殊操作</h2><h3 id="_2-获取稀疏矩阵信息">2. 获取稀疏矩阵信息</h3><pre><code class="language-cpp">int nonZeros = mat.nonZeros();  // 非零元素数量
int rows = mat.rows();          // 行数
int cols = mat.cols();          // 列数</code></pre><h3 id="_3-稀疏矩阵运算">3. 稀疏矩阵运算</h3><pre><code class="language-cpp">Eigen::SparseMatrix&lt;double&gt; mat1, mat2, result;

// 矩阵加法
result = mat1 + mat2;

// 矩阵乘法
result = mat1 * mat2;

// 标量乘法
result = mat1 * 2.0;</code></pre><h2 id="五性能考虑">五、性能考虑</h2><ol><li>对于一次性构建稀疏矩阵，使用Triplet格式最方便</li><li>对于逐步插入元素，使用insert()方法</li><li>频繁操作后调用prune()移除零元素</li></ol><div class="container fullwidth" style="justify-items: end; text-align: end;"><p><a href="https://blog.qgm1702.top/">返回 主页</a></p></div></main>
    <aside class="margin-area" id="margin-area-right"></aside>
  </body>
</html>
