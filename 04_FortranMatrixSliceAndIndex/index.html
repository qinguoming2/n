<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta name="generator" content="Quarkdown">
    <meta charset="UTF-8">
    <meta name="description" content="a blog demo">
    <meta name="author" content="qinguoming">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="quarkdown:root-path" content="..">
    <title>blog</title>
    <script src="../script/quarkdown.js"></script>
    <script>const capabilities = window.quarkdownCapabilities</script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="../theme/theme.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.11.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlightjs-line-numbers.js/2.9.0/highlightjs-line-numbers.min.js"></script>
    <script src="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.js"></script>
    <link href="https://unpkg.com/highlightjs-copy/dist/highlightjs-copy.min.css" rel="stylesheet">
    <script>capabilities.code = true;</script>
    <style>@font-face { font-family: '-503305824'; src: local('Consolas'); }

body {
    --qd-code-custom-font: '-503305824';
    --qd-main-font-size: 12.0pt;}

body.quarkdown-plain.quarkdown-plain,
body.quarkdown-docs.quarkdown-docs {
}

body.quarkdown-slides.quarkdown-slides .reveal {
}

@page {
    size: auto auto;
    margin: 0;}

p {
}</style>
    <script>prepare(new PlainDocument());</script>
<template id="sidebar-template"><nav class="sidebar" role="doc-toc"><ol><li data-target-id="fortran2008数组-切片和索引" data-depth="1"><a href="#fortran2008数组-切片和索引">Fortran2008数组: 切片和索引</a><ol><li data-target-id="_1-基本索引方式" data-depth="2"><a href="#_1-基本索引方式">1. 基本索引方式</a><ol><li data-target-id="_11-单元素访问" data-depth="3"><a href="#_11-单元素访问">1.1 单元素访问</a></li><li data-target-id="_12-多维数组访问" data-depth="3"><a href="#_12-多维数组访问">1.2 多维数组访问</a></li></ol></li><li data-target-id="_2-数组切片方式" data-depth="2"><a href="#_2-数组切片方式">2. 数组切片方式</a><ol><li data-target-id="_21-连续范围切片" data-depth="3"><a href="#_21-连续范围切片">2.1 连续范围切片</a></li><li data-target-id="_22-带步长的切片" data-depth="3"><a href="#_22-带步长的切片">2.2 带步长的切片</a></li><li data-target-id="_23-多维数组切片" data-depth="3"><a href="#_23-多维数组切片">2.3 多维数组切片</a></li></ol></li><li data-target-id="_3-高级索引方式" data-depth="2"><a href="#_3-高级索引方式">3. 高级索引方式</a><ol><li data-target-id="_31-向量下标索引" data-depth="3"><a href="#_31-向量下标索引">3.1 向量下标索引</a></li><li data-target-id="_32-逻辑掩码索引" data-depth="3"><a href="#_32-逻辑掩码索引">3.2 逻辑掩码索引</a></li></ol></li><li data-target-id="_4-特殊切片技术" data-depth="2"><a href="#_4-特殊切片技术">4. 特殊切片技术</a><ol><li data-target-id="_41-隐式循环-implied-do" data-depth="3"><a href="#_41-隐式循环-implied-do">4.1 隐式循环 (implied do)</a></li><li data-target-id="_42-数组构造器切片" data-depth="3"><a href="#_42-数组构造器切片">4.2 数组构造器切片</a></li><li data-target-id="_43-指针关联切片" data-depth="3"><a href="#_43-指针关联切片">4.3 指针关联切片</a></li></ol></li><li data-target-id="_5-数组切片赋值" data-depth="2"><a href="#_5-数组切片赋值">5. 数组切片赋值</a><ol><li data-target-id="_51-标量赋值给切片" data-depth="3"><a href="#_51-标量赋值给切片">5.1 标量赋值给切片</a></li><li data-target-id="_52-数组对数组赋值" data-depth="3"><a href="#_52-数组对数组赋值">5.2 数组对数组赋值</a></li><li data-target-id="_53-自动填充" data-depth="3"><a href="#_53-自动填充">5.3 自动填充</a></li></ol></li><li data-target-id="_6-数组切片在函数中的应用" data-depth="2"><a href="#_6-数组切片在函数中的应用">6. 数组切片在函数中的应用</a><ol><li data-target-id="_61-作为函数参数" data-depth="3"><a href="#_61-作为函数参数">6.1 作为函数参数</a></li><li data-target-id="_62-返回数组切片" data-depth="3"><a href="#_62-返回数组切片">6.2 返回数组切片</a></li></ol></li><li data-target-id="_7-性能注意事项" data-depth="2"><a href="#_7-性能注意事项">7. 性能注意事项</a></li><li data-target-id="_8-特殊数组切片案例" data-depth="2"><a href="#_8-特殊数组切片案例">8. 特殊数组切片案例</a><ol><li data-target-id="_81-对角元素提取" data-depth="3"><a href="#_81-对角元素提取">8.1 对角元素提取</a></li><li data-target-id="_82-块操作" data-depth="3"><a href="#_82-块操作">8.2 块操作</a></li><li data-target-id="_83-条件切片" data-depth="3"><a href="#_83-条件切片">8.3 条件切片</a></li></ol></li></ol></li></ol></nav>
</template>  </head>
  <body class="quarkdown quarkdown-plain">
    <aside class="margin-area" id="margin-area-left"></aside>
    <main><div class="container fullwidth" style="justify-items: end; text-align: end;"><p><a href="https://qinguoming.pages.dev/">返回 主页</a></p></div><div class="page-break" data-hidden=""></div><h1 id="fortran2008数组-切片和索引">Fortran2008数组: 切片和索引</h1><div class="page-break" data-hidden=""></div><h1 id="table-of-contents">目录</h1><nav role="table-of-contents" data-role="table-of-contents"><ol><li data-target-id="fortran2008数组-切片和索引" data-depth="1"><a href="#fortran2008数组-切片和索引">Fortran2008数组: 切片和索引</a><ol><li data-target-id="_1-基本索引方式" data-depth="2"><a href="#_1-基本索引方式">1. 基本索引方式</a><ol><li data-target-id="_11-单元素访问" data-depth="3"><a href="#_11-单元素访问">1.1 单元素访问</a></li><li data-target-id="_12-多维数组访问" data-depth="3"><a href="#_12-多维数组访问">1.2 多维数组访问</a></li></ol></li><li data-target-id="_2-数组切片方式" data-depth="2"><a href="#_2-数组切片方式">2. 数组切片方式</a><ol><li data-target-id="_21-连续范围切片" data-depth="3"><a href="#_21-连续范围切片">2.1 连续范围切片</a></li><li data-target-id="_22-带步长的切片" data-depth="3"><a href="#_22-带步长的切片">2.2 带步长的切片</a></li><li data-target-id="_23-多维数组切片" data-depth="3"><a href="#_23-多维数组切片">2.3 多维数组切片</a></li></ol></li><li data-target-id="_3-高级索引方式" data-depth="2"><a href="#_3-高级索引方式">3. 高级索引方式</a><ol><li data-target-id="_31-向量下标索引" data-depth="3"><a href="#_31-向量下标索引">3.1 向量下标索引</a></li><li data-target-id="_32-逻辑掩码索引" data-depth="3"><a href="#_32-逻辑掩码索引">3.2 逻辑掩码索引</a></li></ol></li><li data-target-id="_4-特殊切片技术" data-depth="2"><a href="#_4-特殊切片技术">4. 特殊切片技术</a><ol><li data-target-id="_41-隐式循环-implied-do" data-depth="3"><a href="#_41-隐式循环-implied-do">4.1 隐式循环 (implied do)</a></li><li data-target-id="_42-数组构造器切片" data-depth="3"><a href="#_42-数组构造器切片">4.2 数组构造器切片</a></li><li data-target-id="_43-指针关联切片" data-depth="3"><a href="#_43-指针关联切片">4.3 指针关联切片</a></li></ol></li><li data-target-id="_5-数组切片赋值" data-depth="2"><a href="#_5-数组切片赋值">5. 数组切片赋值</a><ol><li data-target-id="_51-标量赋值给切片" data-depth="3"><a href="#_51-标量赋值给切片">5.1 标量赋值给切片</a></li><li data-target-id="_52-数组对数组赋值" data-depth="3"><a href="#_52-数组对数组赋值">5.2 数组对数组赋值</a></li><li data-target-id="_53-自动填充" data-depth="3"><a href="#_53-自动填充">5.3 自动填充</a></li></ol></li><li data-target-id="_6-数组切片在函数中的应用" data-depth="2"><a href="#_6-数组切片在函数中的应用">6. 数组切片在函数中的应用</a><ol><li data-target-id="_61-作为函数参数" data-depth="3"><a href="#_61-作为函数参数">6.1 作为函数参数</a></li><li data-target-id="_62-返回数组切片" data-depth="3"><a href="#_62-返回数组切片">6.2 返回数组切片</a></li></ol></li><li data-target-id="_7-性能注意事项" data-depth="2"><a href="#_7-性能注意事项">7. 性能注意事项</a></li><li data-target-id="_8-特殊数组切片案例" data-depth="2"><a href="#_8-特殊数组切片案例">8. 特殊数组切片案例</a><ol><li data-target-id="_81-对角元素提取" data-depth="3"><a href="#_81-对角元素提取">8.1 对角元素提取</a></li><li data-target-id="_82-块操作" data-depth="3"><a href="#_82-块操作">8.2 块操作</a></li><li data-target-id="_83-条件切片" data-depth="3"><a href="#_83-条件切片">8.3 条件切片</a></li></ol></li></ol></li></ol></nav><p>Fortran 提供了多种灵活的数组索引和切片操作方式，以下是全面的总结：</p><h2 id="_1-基本索引方式">1. 基本索引方式</h2><h3 id="_11-单元素访问">1.1 单元素访问</h3><pre><code class="language-shell">real :: A(10)
A(5) = 3.14  ! 访问第5个元素</code></pre><h3 id="_12-多维数组访问">1.2 多维数组访问</h3><pre><code class="language-shell">real :: B(3,3)
B(2,3) = 2.0  ! 访问第2行第3列元素</code></pre><h2 id="_2-数组切片方式">2. 数组切片方式</h2><h3 id="_21-连续范围切片">2.1 连续范围切片</h3><pre><code class="language-shell">integer :: arr(10) = [(i, i=1,10)]
print *, arr(3:7)  ! 输出 [3,4,5,6,7]
print *, arr(:5)   ! 输出前5个元素 [1,2,3,4,5]
print *, arr(6:)   ! 输出第6个及之后元素 [6,7,8,9,10]</code></pre><h3 id="_22-带步长的切片">2.2 带步长的切片</h3><pre><code class="language-shell">print *, arr(1:10:2)  ! 输出 [1,3,5,7,9]
print *, arr(10:1:-1) ! 逆序输出 [10,9,8,7,6,5,4,3,2,1]</code></pre><h3 id="_23-多维数组切片">2.3 多维数组切片</h3><pre><code class="language-shell">real :: matrix(5,5)
matrix(2:4, 3) = 1.0  ! 第3列的第2-4行
matrix(:, 1) = 0.0     ! 第1列全部元素
matrix(5, 2:4) = 2.0   ! 第5行的2-4列</code></pre><h2 id="_3-高级索引方式">3. 高级索引方式</h2><h3 id="_31-向量下标索引">3.1 向量下标索引</h3><pre><code class="language-shell">integer :: idx(3) = [2,5,7]
print *, arr(idx)  ! 输出 [arr(2), arr(5), arr(7)]</code></pre><h3 id="_32-逻辑掩码索引">3.2 逻辑掩码索引</h3><pre><code class="language-shell">logical :: mask(10)
mask = arr &gt; 5      ! 创建逻辑掩码
print *, arr(mask)  ! 输出大于5的元素</code></pre><h2 id="_4-特殊切片技术">4. 特殊切片技术</h2><h3 id="_41-隐式循环-implied-do">4.1 隐式循环 (implied do)</h3><pre><code class="language-shell">print *, (arr(i), i=2,8,2)  ! 输出 [arr(2), arr(4), arr(6), arr(8)]</code></pre><h3 id="_42-数组构造器切片">4.2 数组构造器切片</h3><pre><code class="language-shell">real :: new_arr(3) = [arr(3), arr(5), arr(7)]</code></pre><h3 id="_43-指针关联切片">4.3 指针关联切片</h3><pre><code class="language-shell">real, pointer :: p(:)
p =&gt; arr(3:7)  ! p指向arr的子数组
p(1) = 99.0    ! 会修改原数组arr(3)的值</code></pre><h2 id="_5-数组切片赋值">5. 数组切片赋值</h2><h3 id="_51-标量赋值给切片">5.1 标量赋值给切片</h3><pre><code class="language-shell">arr(3:7) = 0.0  ! 将第3-7个元素设为0</code></pre><h3 id="_52-数组对数组赋值">5.2 数组对数组赋值</h3><pre><code class="language-shell">real :: source(5) = [1.0,2.0,3.0,4.0,5.0]
arr(1:5) = source  ! 将source复制到arr的前5个位置</code></pre><h3 id="_53-自动填充">5.3 自动填充</h3><pre><code class="language-shell">arr(1:10:2) = 1.0  ! 奇数位置设为1.0
arr(2:10:2) = 2.0  ! 偶数位置设为2.0</code></pre><h2 id="_6-数组切片在函数中的应用">6. 数组切片在函数中的应用</h2><h3 id="_61-作为函数参数">6.1 作为函数参数</h3><pre><code class="language-shell">call process_subarray(arr(3:7))  ! 传递子数组

subroutine process_subarray(sub)
    real :: sub(:)
    ! ...处理子数组...
end subroutine</code></pre><h3 id="_62-返回数组切片">6.2 返回数组切片</h3><pre><code class="language-shell">function get_even_elements(a) result(even)
    real, intent(in) :: a(:)
    real :: even(size(a)/2)
    even = a(::2)  ! 返回偶数索引元素
end function</code></pre><h2 id="_7-性能注意事项">7. 性能注意事项</h2><ol><li><strong>连续访问</strong>：Fortran是列优先存储，<span class="codespan-content"><code>matrix(:,j)</code></span>比<span class="codespan-content"><code>matrix(i,:)</code></span>效率更高</li><li><strong>临时数组</strong>：复杂切片可能产生临时数组，影响性能</li><li><strong>向量化</strong>：简单连续切片更易被编译器优化</li><li><strong>边界检查</strong>：使用<span class="codespan-content"><code>-fno-bounds-check</code></span>关闭边界检查可提高性能（调试时不建议）</li></ol><h2 id="_8-特殊数组切片案例">8. 特殊数组切片案例</h2><h3 id="_81-对角元素提取">8.1 对角元素提取</h3><pre><code class="language-shell">real :: diag(3) = [matrix(i,i), i=1,3]  ! 提取3x3矩阵对角线</code></pre><h3 id="_82-块操作">8.2 块操作</h3><pre><code class="language-shell">matrix(2:3, 2:3) = 0.0  ! 将中心2x2子矩阵置零
sub_arr=matrix([1,3],[1,3]) ! 返回一个2*2的矩阵</code></pre><h3 id="_83-条件切片">8.3 条件切片</h3><pre><code class="language-shell">print *, pack(arr, arr &gt; 5.0)  ! 输出大于5的元素</code></pre><p>Fortran的数组切片功能非常强大，合理使用可以写出既简洁又高效的代码。对于性能关键代码，建议结合具体编译器优化特性进行调优。</p><div class="container fullwidth" style="justify-items: end; text-align: end;"><p><a href="https://qinguoming.pages.dev/">返回 主页</a></p></div></main>
    <aside class="margin-area" id="margin-area-right"></aside>
  </body>
</html>
